DataONE_Operations
==================

Utilities for administrative operations in DataONE.

Many of these utilities require administrative access to DataONE servers, and so
are not appropriate for general end-user use.


Documentation
-------------

* The `Wiki`_ at https://github.com/DataONEorg/DataONE_Operations/wiki

See also the operations docs in subversion:

* https://purl.dataone.org/operations/index.html


.. _Wiki: https://github.com/DataONEorg/DataONE_Operations/wiki


Installation
------------

Installs a locally editable version of the tools:

1. Checkout this project from GitHub

2. ``cd`` to the project

3. ``pip install -U -e .``

This assumes that you have the DataONE python common and libclient libraries installed. If
not then install from PyPi (``pip install dataone.libclient``) or for a locally editable install:

1. Checkout d1_python_

2. ``pip install -U -e d1_python/d1_common_python/src``

3. ``pip install -U -e d1_python/d1_libclient_python/src``

.. _d1_python: https://github.com/DataONEorg/d1_python

**Locally editable installation in a virtual environment with Conda**

If you have Anaconda_ installed (highly recommended), then the following installation steps provide a setup that can be tweaked::

  conda create -n d1tools-dev python=2.7
  source activate d1tools-dev
  cd d1tools-dev
  pip install -U setuptools
  pip install -U humanize
  export CC=/usr/bin/clang
  export CXX=/usr/bin/clang++
  git clone "https://github.com/DataONEorg/d1_python.git"
  git clone "https://github.com/DataONEorg/DataONE_Operations.git"
  pip install -U -e d1_python/d1_common_python/src
  pip install -U -e d1_python/d1_libclient_python/src
  pip install -U -e DataONE_Operations

.. _Anaconda: https://www.continuum.io/downloads

Initialization
--------------

The scripts rely on configuration information that by default is located in::

  ${HOME}/.dataone/d1_config.json

A default config can be generated by running::

  python d1_admin_tools/d1_config.py -i


The Scripts
-----------

All scripts are meant to be run from a BASH command line (untested on windows), send output to stdout.
Output in text, json, xml is generally supported.

* ``d1hosts`` List DataONE CNs in an environment.
* ``d1resolve`` Resolve an identifier.
* ``d1sysmeta`` Retrieve system metadata given an identifier.
* ``d1nodes`` Show the list of nodes in an environment.
* ``d1fields`` Retrieves a list of fields from the specified solr core.
* ``d1facets`` Retrieves values for a solr field in the specified solr core.
* ``d1getpids`` Retrieves identifiers from metacat postgres and checks file system consistency.
* ``d1listobjects`` Run listObjects against a node with various filter options.
* ``urlx`` URL encode / decode stdin or string parameter.
* ``d1delete`` Issues a call to CNCore.delete() for a single PID.
* ``d1archive`` Issues a call to CNCore.archive() for a single PID.
* ``d1indexqstat`` Retrieves counts from the index processor task queue.
* ``d1mnadmin`` Reset synchronization time, update MN node document


Code style
----------

See https://github.com/DataONEorg/d1_python#code-style

